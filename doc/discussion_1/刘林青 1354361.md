#讨论课问题解决方案
####刘林青 1354361
##一、长连接心跳机制：### 长连接：
连接—>数据传输－>保持连接（心跳）－>数据传输－>保持连接（心跳）－>… 关闭连接.### 长连接心跳：
在建立TCP连接时，如果长时间没有数据往来的话，会被运营商网络主动断掉。长连接会每隔一段时间（一般小于服务器检测时间间隔）向运营服务器发送一个心跳包，通知它自己仍然处于在线状态，不要断掉连接。连接可能因为以下原因被断开：关闭连接，关闭程序，关闭计算机，网络硬件故障（拔网线）。其中关闭计算机和网络硬件故障是没有机会断开连接的，此时需要心跳机制来保证断开。
### 实现：
通过netty可以实现服务端和客户端的长连接通讯以及心跳检测。Netty服务端通过一个Map保存所有连接上来的客户端SocketChannel，客户端的ID作为Map的key。每次服务器端如果要向某个客户端发送消息，只需根据clientID取出对应的SocketChannel，往里面写入message即可。心跳检测通过IdleEvent事件，定时向服务端发送Ping消息，检测SocketChannel是否中断。##二、消息不重不漏
### mqtt开放协议:
- 轻量级的 machine-to-machine 通信协议。
- publish/subscribe模式。
- 基于TCP/IP。
- 支持QoS。
- 适合于低带宽、不可靠连接、嵌入式设备、CPU内存资源紧张。
- FacebookMessenger采用了MQTT。
###### 针对低带宽不稳定网络：
1. mqtt的最小传输字节只需要两个字节同时
2. mqtt还提供了设备“遗言”等特性，当一台设备连不上网络的时候(野外设备常常有)，会有一套机制允许设备“退休”前发送一条特别的消息给服务端，告知维护人员或者相关程序。
###### 针对消息不重不漏
1. QoS是MQTT的特色，该协议保证了在不稳定网络下的信息重复和信息遗漏问题。
2. 三级QoS（Qos2）：
	- QoS0 :sender向receiver发消息，receiver直接处理消息，但是不会确认消息接受。
	- QoS1 :sender向receiver发送消息，receiver向sender发送消息确认接受的回复。[可以保证消息至少成功发送给receiver一次]
	- <b>QoS2 </b>:		- receiver->sender发送PUBREC(已收到)
		- sender -> receiver发送PUBREL(已释放)
		- receiver -> sender发送PUBCOMP（已完成），Client删除消息	

##三、消息压缩
本系统中只考虑了文本信息，在被序列化之后，可以使用常见的gzip方法进行压缩。常见压缩算法如下：</br>

- 字典算法：</br>
字典算法是最为简单的压缩算法之一。它是把文本中出现频率比较多的单词或词汇组合做成一个对应的字典列表，并用特殊代码来表示这个单词或词汇。例如：
有字典列表：
00=Chinese
01=People
02=China
源文本：I am a Chinese people,I am from China 压缩后的编码为：I am a 00 01,I am from 02。
- 固定位长算法（Fixed Bit Length Packing）：</br>
这种算法是把文本用需要的最少的位来进行压缩编码。
比 如八个十六进制数：1，2，3，4，5，6，7，8。转换为二进制为：00000001，00000010，00000011，00000100， 00000101，00000110，00000111，00001000。每个数只用到了低4位，而高4位没有用到（全为0），因此对低4位进行压缩编 码后得到：0001，0010，0011，0100，0101，0110，0111，1000。然后补充为字节得到：00010010， 00110100，01010110，01111000。所以原来的八个十六进制数缩短了一半，得到4个十六进制数：12，34，56，78。
- 霍夫曼编码（Huffman Encoding）:</br>
哈夫曼编码是无损压缩当中最好的方法。它使用预先二进制描述来替换每个符号，长度由特殊符号出现的频率决定。常见的符号需要很少的位来表示，而不常见的符号需要很多为来表示。
基本的原理是为每个符号找到新的二进制表示，从而通常符号使用很少的位，不常见的符号使用较多的位。</br>
这棵树有两个目的：
	- 编码器使用这棵树来找到每个符号最优的表示方法
	- 解码器使用这棵树唯一的标识在压缩流中每个编码的开始和结束，其通过在读压缩数据位的时候自顶向底的遍历树，选择基于数据流中的每个独立位的分支，一旦一个到达叶子节点，解码器知道一个完整的编码已经读出来了




